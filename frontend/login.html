<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login - FabricStudio Assistant</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #f5f5f7; margin: 0; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;">
    <div style="background: white; border: 1px solid #d2d2d7; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 400px; max-width: 90%; padding: 32px; border-radius: 0;">
      <div style="text-align: center; margin-bottom: 32px;">
        <img src="/images/Fortinet-logomark-rgb-red.svg" alt="Fortinet" style="height: 56px; width: auto; margin-bottom: 16px;" />
        <h1 style="margin: 0; font-size: 24px; font-weight: 600; color: #1d1d1f; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;">FabricStudio Assistant</h1>
        <p style="margin: 8px 0 0 0; color: #86868b; font-size: 14px;">Please login to continue</p>
      </div>
      
      <form id="loginForm">
        <div style="margin-bottom: 20px;">
          <label for="username" style="display: block; margin-bottom: 6px; font-weight: 500; color: #1d1d1f; font-size: 14px;">Username:</label>
          <input 
            type="text" 
            id="username" 
            name="username" 
            autocomplete="username"
            required
            style="width: 100%; box-sizing: border-box; padding: 10px 12px; border: 1px solid #d2d2d7; border-radius: 0; font-size: 14px; min-height: 40px; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;"
          />
        </div>
        
        <div style="margin-bottom: 24px;">
          <label for="password" style="display: block; margin-bottom: 6px; font-weight: 500; color: #1d1d1f; font-size: 14px;">Password:</label>
          <input 
            type="password" 
            id="password" 
            name="password" 
            autocomplete="current-password"
            required
            style="width: 100%; box-sizing: border-box; padding: 10px 12px; border: 1px solid #d2d2d7; border-radius: 0; font-size: 14px; min-height: 40px; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;"
          />
        </div>
        
        <div id="errorMessage" style="color: #f87171; margin-bottom: 16px; display: none; font-size: 14px;"></div>
        
        <button 
          type="submit" 
          id="loginButton"
          style="width: 100%; padding: 12px; font-size: 16px; font-weight: 600; min-height: 44px; background: #da291c; color: white; border: none; border-radius: 0; cursor: pointer; box-shadow: 0 2px 4px rgba(218, 41, 28, 0.3); transition: transform 0.1s ease, filter 0.1s ease; font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif;"
        >
          Login
        </button>
      </form>
    </div>
    
    <script>
      const el = (id) => document.getElementById(id);
      
      // Check if already authenticated
      async function checkAuth() {
        try {
          const res = await fetch('/user/current', {
            credentials: 'include'
          });
          if (res.ok) {
            // Already authenticated, redirect to main app
            window.location.href = '/';
            return true;
          }
          return false;
        } catch (e) {
          return false;
        }
      }
      
      // Handle login form submission
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = el('username').value.trim();
        const password = el('password').value;
        const errorMsg = el('errorMessage');
        const loginBtn = el('loginButton');
        
        if (!username || !password) {
          errorMsg.textContent = 'Please enter username and password';
          errorMsg.style.display = 'block';
          return;
        }
        
        loginBtn.disabled = true;
        loginBtn.textContent = 'Logging in...';
        loginBtn.style.opacity = '0.7';
        loginBtn.style.cursor = 'not-allowed';
        errorMsg.style.display = 'none';
        
        try {
          const res = await fetch('/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ username, password })
          });
          
          if (res.ok) {
            // Login successful, redirect to main app
            window.location.href = '/';
          } else {
            const data = await res.json().catch(() => ({ detail: 'Login failed' }));
            errorMsg.textContent = data.detail || 'Invalid username or password';
            errorMsg.style.display = 'block';
            loginBtn.disabled = false;
            loginBtn.textContent = 'Login';
            loginBtn.style.opacity = '1';
            loginBtn.style.cursor = 'pointer';
          }
        } catch (e) {
          errorMsg.textContent = 'Login failed. Please try again.';
          errorMsg.style.display = 'block';
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
          loginBtn.style.opacity = '1';
          loginBtn.style.cursor = 'pointer';
        }
      });
      
      // Check authentication on page load
      checkAuth();
      
      // Focus username field
      el('username').focus();
    </script>
  </body>
</html>

